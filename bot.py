#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
üîÆ –ê–°–¢–†–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ë–û–¢ ‚Äî –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø
‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ—Å–∫–æ–ø—ã —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏, –ª—É–Ω–Ω—ã–º–∏ —Ñ–∞–∑–∞–º–∏ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π
‚úÖ HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Render
‚úÖ –ê–¥–º–∏–Ω–∫–∞ (/admin)
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–º–∏—É–º
‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
"""

import logging
import random
import json
import os
import hashlib
import uuid
import asyncio
from datetime import datetime, timedelta
from threading import Thread, Lock
from http.server import HTTPServer, BaseHTTPRequestHandler
from dotenv import load_dotenv

from telegram import (
    Update,
    ReplyKeyboardMarkup,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    LabeledPrice
)
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    ContextTypes,
    filters,
    PreCheckoutQueryHandler
)

# ====== –ó–ê–ì–†–£–ó–ö–ê –ü–ï–†–ï–ú–ï–ù–ù–´–• –û–ö–†–£–ñ–ï–ù–ò–Ø ======
load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")
PAYMENT_PROVIDER_TOKEN = os.getenv("PAYMENT_PROVIDER_TOKEN")

if not BOT_TOKEN:
    raise ValueError("‚ùå –û–®–ò–ë–ö–ê: –ù–µ –∑–∞–¥–∞–Ω BOT_TOKEN –≤ .env —Ñ–∞–π–ª–µ!")
if not PAYMENT_PROVIDER_TOKEN:
    raise ValueError("‚ùå –û–®–ò–ë–ö–ê: –ù–µ –∑–∞–¥–∞–Ω PAYMENT_PROVIDER_TOKEN –≤ .env —Ñ–∞–π–ª–µ!")

# ====== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ê–î–ú–ò–ù–ê ======
ADMIN_USER_ID = 6198172981  # –í–∞—à ID –∏–∑ –ª–æ–≥–æ–≤
TECHNICAL_WORKS = False

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏
os.makedirs('data', exist_ok=True)

# ====== –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ======
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(),
        logging.FileHandler('data/astrology_bot.log', encoding='utf-8')
    ]
)
logger = logging.getLogger(__name__)

print("=" * 70)
print("üîÆ –ê–°–¢–†–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ë–û–¢ ‚Äî –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø")
print(f"‚úÖ –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω: {BOT_TOKEN[:10]}...")
print(f"‚úÖ –ü–ª–∞—Ç–µ–∂–Ω—ã–π —Ç–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω: {PAYMENT_PROVIDER_TOKEN[:20]}...")
print(f"üëë –ê–¥–º–∏–Ω ID: {ADMIN_USER_ID}")
print("=" * 70)

# ====== –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´ –ü–†–ï–ú–ò–£–ú –ì–û–†–û–°–ö–û–ü–û–í ======
PREMIUM_HOROSCOPES = {}
if os.path.exists('horoscopes_premium.json'):
    try:
        with open('horoscopes_premium.json', 'r', encoding='utf-8') as f:
            PREMIUM_HOROSCOPES = json.load(f)
        logger.info(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(PREMIUM_HOROSCOPES)} –¥–Ω–µ–π –ø—Ä–µ–º–∏—É–º-–≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤: {e}")
else:
    logger.warning("‚ö†Ô∏è –§–∞–π–ª horoscopes_premium.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã.")

# ====== –õ–£–ù–ù–´–ï –§–ê–ó–´ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç) ======
def get_moon_phase(date=None):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª—É–Ω–Ω—É—é —Ñ–∞–∑—É –¥–ª—è –¥–∞—Ç—ã"""
    if date is None:
        date = datetime.now()
    
    # –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞—Å—Ç—Ä–æ–ª–æ–≥–∏–∏)
    known_new_moon = datetime(2000, 1, 6, 18, 14)  # –ò–∑–≤–µ—Å—Ç–Ω–æ–µ –Ω–æ–≤–æ–ª—É–Ω–∏–µ
    lunar_cycle = 29.53058867  # –¥–Ω–µ–π
    
    days_since = (date - known_new_moon).total_seconds() / 86400
    moon_age = days_since % lunar_cycle
    
    if moon_age < 1.845:
        return "üåë –ù–æ–≤–æ–ª—É–Ω–∏–µ", "–í—Ä–µ–º—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π. –≠–Ω–µ—Ä–≥–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–Ω—É—Ç—Ä—å."
    elif moon_age < 5.535:
        return "üåí –†–∞—Å—Ç—É—â–∞—è –õ—É–Ω–∞", "–≠–Ω–µ—Ä–≥–∏—è –Ω–∞–±–∏—Ä–∞–µ—Ç —Å–∏–ª—É. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤."
    elif moon_age < 9.225:
        return "üåì –ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å", "–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏–π –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π."
    elif moon_age < 12.915:
        return "üåî –†–∞—Å—Ç—É—â–∞—è –õ—É–Ω–∞", "–≠–Ω–µ—Ä–≥–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞—Å—Ç–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã."
    elif moon_age < 14.765:
        return "üåï –ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ", "–ü–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏. –í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–¥–≤–µ–¥–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤."
    elif moon_age < 18.455:
        return "üåñ –£–±—ã–≤–∞—é—â–∞—è –õ—É–Ω–∞", "–≠–Ω–µ—Ä–≥–∏—è —Å–Ω–∏–∂–∞–µ—Ç—Å—è. –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è."
    elif moon_age < 22.145:
        return "üåó –ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å", "–í—Ä–µ–º—è –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è."
    elif moon_age < 25.835:
        return "üåò –£–±—ã–≤–∞—é—â–∞—è –õ—É–Ω–∞", "–≠–Ω–µ—Ä–≥–∏—è —É—Ö–æ–¥–∏—Ç. –í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è."
    else:
        return "üåë –ù–æ–≤–æ–ª—É–Ω–∏–µ", "–¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –Ω–æ–≤–æ–º—É –Ω–∞—á–∞–ª—É."

# ====== –í–†–ï–ú–ï–ù–ù–´–ï –ü–ï–†–ò–û–î–´ ======
def get_time_period():
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–∏–æ–¥ —Å—É—Ç–æ–∫"""
    hour = datetime.now().hour
    if 5 <= hour < 12:
        return "—É—Ç—Ä–æ", [
            "–£—Ç—Ä–µ–Ω–Ω—è—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞–ø–æ–ª–Ω—è–µ—Ç –≤–∞—Å —Å–∏–ª–∞–º–∏",
            "–ù–æ–≤—ã–π –¥–µ–Ω—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
            "–°–≤–µ–∂–∏–µ –∏–¥–µ–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å —Ä–∞—Å—Å–≤–µ—Ç–æ–º",
            "–£—Ç—Ä–æ ‚Äî –≤—Ä–µ–º—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π",
            "–°–æ–ª–Ω–µ—á–Ω—ã–π —Å–≤–µ—Ç —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É –∏–Ω—Ç—É–∏—Ü–∏—é"
        ]
    elif 12 <= hour < 18:
        return "–¥–µ–Ω—å", [
            "–î–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ –ø–∏–∫–µ",
            "–°–æ–ª–Ω—Ü–µ –≤ –∑–µ–Ω–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è",
            "–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–Ω–æ–≤ –∏ –≤—Å—Ç—Ä–µ—á",
            "–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É–µ—Ç –æ–±—â–µ–Ω–∏—é",
            "–ü–æ–ª–¥–µ–Ω—å ‚Äî –º–æ–º–µ–Ω—Ç —è—Å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏–π"
        ]
    elif 18 <= hour < 23:
        return "–≤–µ—á–µ—Ä", [
            "–í–µ—á–µ—Ä–Ω—è—è –≥–∞—Ä–º–æ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –Ω–∞ –æ—Ç–¥—ã—Ö",
            "–ó–∞–∫–∞—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é",
            "–í—Ä–µ–º—è –¥–ª—è –±–ª–∏–∑–∫–∏—Ö –∏ –¥—É—à–µ–≤–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤",
            "–í–µ—á–µ—Ä–Ω—è—è —ç–Ω–µ—Ä–≥–∏—è —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —Ç–≤–æ—Ä—á–µ—Å—Ç–≤—É",
            "–°—É–º–µ—Ä–∫–∏ ‚Äî –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –º–∏—Ä—É"
        ]
    else:
        return "–Ω–æ—á—å", [
            "–ù–æ—á–Ω–∞—è —Ç–∏—à–∏–Ω–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç—É–∏—Ü–∏—é",
            "–ó–≤—ë–∑–¥—ã –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –≤–∞—à–∏ –º—ã—Å–ª–∏",
            "–í—Ä–µ–º—è —Å–Ω–æ–≤ –∏ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–∑–∞—Ä–µ–Ω–∏–π",
            "–ù–æ—á—å ‚Äî –ø–µ—Ä–∏–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏",
            "–õ—É–Ω–Ω—ã–π —Å–≤–µ—Ç –æ—Å–≤–µ—â–∞–µ—Ç –ø—É—Ç—å –∫ –∏—Å—Ç–∏–Ω–µ"
        ]

# ====== –†–ê–°–®–ò–†–ï–ù–ù–´–ï –°–ü–ò–°–ö–ò –î–õ–Ø –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò ======
ENERGY_TEXTS = [
    "–î–µ–Ω—å –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–≤—ã–º –Ω–∞—á–∏–Ω–∞–Ω–∏—è–º. –î–µ–π—Å—Ç–≤—É–π—Ç–µ —Å–º–µ–ª–æ!",
    "–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –ø–æ–∫–æ—é.",
    "–î–æ–≤–µ—Ä—è–π—Ç–µ –∏–Ω—Ç—É–∏—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è.",
    "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—à –¥–µ–Ω—å –∫ –ª—É—á—à–µ–º—É.",
    "–ó–≤–µ–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º–∏ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö.",
    "–û—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –∏ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è.",
    "–°–µ–≥–æ–¥–Ω—è –≤–∞–∂–Ω–æ —É–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –±–ª–∏–∑–∫–∏–º –ª—é–¥—è–º.",
    "–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—ä–µ–º –ø–æ–º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π.",
    "–õ—É–Ω–∞ –≤ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–º –∞—Å–ø–µ–∫—Ç–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É –∏–Ω—Ç—É–∏—Ü–∏—é.",
    "–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã–µ –≤–∏–±—Ä–∞—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–∞—à–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.",
    "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.",
    "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.",
    "–ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –∫ –∑–Ω–∞–∫–∞–º —Å—É–¥—å–±—ã —Å–µ–≥–æ–¥–Ω—è.",
    "–î–µ–Ω—å —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –¥—É—Ö–æ–≤–Ω–æ–º—É —Ä–æ—Å—Ç—É –∏ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—é.",
    "–ó–≤–µ–∑–¥–Ω—ã–π —Å–≤–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∞—Å –∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º.",
    "–°–µ–≥–æ–¥–Ω—è —É–¥–∞—á–∞ –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ!",
    "–≠–Ω–µ—Ä–≥–∏—è –ú–µ—Ä–∫—É—Ä–∏—è —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –∏ –æ–±—É—á–µ–Ω–∏–µ.",
    "–í–µ–Ω–µ—Ä–∞ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏–∫–µ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤—É.",
    "–ú–∞—Ä—Å –¥–∞–µ—Ç —Å–∏–ª—ã –¥–ª—è –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π.",
    "–Æ–ø–∏—Ç–µ—Ä —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.",
    "–°–∞—Ç—É—Ä–Ω —É–∫—Ä–µ–ø–ª—è–µ—Ç –≤–∞—à—É –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ —Ä–µ—à–∏–º–æ—Å—Ç—å.",
    "–£—Ä–∞–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ–∑–∞—Ä–µ–Ω–∏—è –∏ –∏–¥–µ–∏.",
    "–ù–µ–ø—Ç—É–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥—É—Ö–æ–≤–Ω—É—é —Å–≤—è–∑—å –∏ —ç–º–ø–∞—Ç–∏—é.",
    "–ü–ª—É—Ç–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ."
]

LOVE_TEXTS = [
    "–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –∂–¥—É—Ç –≤–∞—Å —Å–µ–≥–æ–¥–Ω—è",
    "–ì–ª—É–±–æ–∫–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —É–∫—Ä–µ–ø—è—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
    "–ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤—ã–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞–º",
    "–í–µ—á–µ—Ä –æ–±–µ—â–∞–µ—Ç –ø—Ä–∏—è—Ç–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ",
    "–í–æ–∑–º–æ–∂–Ω–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ",
    "–î–µ–Ω—å –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–µ–Ω –¥–ª—è –ø—Ä–∏–∑–Ω–∞–Ω–∏–π –≤ —á—É–≤—Å—Ç–≤–∞—Ö",
    "–õ—é–±–æ–≤—å —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è –∏ –∑–∞–±–æ—Ç—ã —Å–µ–≥–æ–¥–Ω—è",
    "–ü–∞—Ä—Ç–Ω–µ—Ä –æ—Ü–µ–Ω–∏—Ç –≤–∞—à—É –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å",
    "–û–¥–∏–Ω–æ–∫–∏–µ —Å–µ—Ä–¥—Ü–∞ –º–æ–≥—É—Ç –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å —Å—É–¥—å–±–æ–Ω–æ—Å–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞",
    "–°–µ–º–µ–π–Ω—ã–µ —É–∑—ã —Å—Ç–∞–Ω—É—Ç –∫—Ä–µ–ø—á–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—é",
    "–†–æ–º–∞–Ω—Ç–∏–∫–∞ —Ä–∞—Å—Ü–≤–µ—Ç–µ—Ç –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ",
    "–ù–µ –±–æ–π—Ç–µ—Å—å –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –∏—Å—Ç–∏–Ω–Ω—ã–µ —á—É–≤—Å—Ç–≤–∞",
    "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å–≤–∏–¥–∞–Ω–∏—è",
    "–õ—é–±–æ–≤–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –≤—ã–π–¥—É—Ç –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å",
    "–î–æ–≤–µ—Ä–∏–µ –∏ —á–µ—Å—Ç–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å–µ–≥–æ–¥–Ω—è",
    "–ú–∞–ª–µ–Ω—å–∫–∏–π –∂–µ—Å—Ç –≤–Ω–∏–º–∞–Ω–∏—è –ø—Ä–∏–Ω–µ—Å–µ—Ç –±–æ–ª—å—à–∏–µ –ø–ª–æ–¥—ã",
    "–ó–≤–µ–∑–¥—ã –±–ª–∞–≥–æ–≤–æ–ª—è—Ç —Ç–µ–º, –∫—Ç–æ —Å–ª—É—à–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ",
    "–í–µ—á–µ—Ä–Ω—è—è –ø—Ä–æ–≥—É–ª–∫–∞ —Å –ª—é–±–∏–º—ã–º —É–∫—Ä–µ–ø–∏—Ç —Å–≤—è–∑—å",
    "–°–ª–æ–≤–∞ –ª—é–±–≤–∏, —Å–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–µ–≥–æ–¥–Ω—è, –∑–∞–ø–æ–º–Ω—è—Ç—Å—è –Ω–∞–¥–æ–ª–≥–æ",
    "–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –∫ –¥–∏–∞–ª–æ–≥—É —Ä–µ—à–∏—Ç –ª—é–±—ã–µ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è",
    "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–ª–∏–∑–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –Ω–æ–≤–æ–π –≥–ª—É–±–∏–Ω—ã",
    "–í—Ä–µ–º—è –ø—Ä–æ—è–≤–∏—Ç—å –∑–∞–±–æ—Ç—É –∏ –Ω–µ–∂–Ω–æ—Å—Ç—å –∫ –ø–∞—Ä—Ç–Ω–µ—Ä—É",
    "–õ—é–±–æ–≤—å —Å–µ–≥–æ–¥–Ω—è —Ç—Ä–µ–±—É–µ—Ç –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Å–≤–æ–±–æ–¥–æ–π –∏ –±–ª–∏–∑–æ—Å—Ç—å—é",
    "–ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —á—É–≤—Å—Ç–≤–∞—Ö –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã"
]

CAREER_TEXTS = [
    "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∏–∑–∏—Ä—É—é—Ç—Å—è",
    "–ö–æ–ª–ª–µ–≥–∏ –æ–∫–∞–∂—É—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤ –≤–∞–∂–Ω–æ–º –¥–µ–ª–µ",
    "–°–º–µ–ª—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–µ—Å—É—Ç –ø–ª–æ–¥—ã",
    "–í–æ–∑–º–æ–∂–µ–Ω –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –∏–ª–∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ",
    "–£–¥–∞—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤",
    "–ü—Ä–æ—è–≤–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ —Ä–∞–±–æ—á–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö",
    "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –æ—Ç–∫—Ä–æ—é—Ç –Ω–æ–≤—ã–µ –¥–≤–µ—Ä–∏",
    "–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ –∑–∞–¥–∞—á–∞–º –±—É–¥–µ—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω",
    "–°–µ–≥–æ–¥–Ω—è –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∏–¥–µ–π",
    "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è –Ω–∞ –≤—ã—Å–æ—Ç–µ ‚Äî –¥–æ–≤–µ—Ä—è–π—Ç–µ –µ–π",
    "–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤—ã–¥–∞—é—â–∏–µ—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã",
    "–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –ø–æ–≤–æ—Ä–æ—Ç–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º",
    "–£–º–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç—å –ø—Ä–∏–Ω–µ—Å–µ—Ç —É–≤–∞–∂–µ–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞",
    "–°–º–µ–ª–æ—Å—Ç—å –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π –≤—ã–¥–µ–ª–∏—Ç –≤–∞—Å —Å—Ä–µ–¥–∏ –¥—Ä—É–≥–∏—Ö",
    "–î–µ–Ω—å –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–µ–Ω –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–∞–≤—ã–∫–æ–≤",
    "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å–µ–±—è –æ–∫—É–ø—è—Ç—Å—è —Å—Ç–æ—Ä–∏—Ü–µ–π",
    "–°–µ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–∏—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–æ–≤—ã–º –≤—Å—Ç—Ä–µ—á–∞–º",
    "–î–µ—Ç–∞–ª–∏ –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —É–¥–µ–ª–∏—Ç–µ –∏–º –≤–Ω–∏–º–∞–Ω–∏–µ",
    "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–≤–æ–∏—Ö —Å–∏–ª–∞—Ö –ø—Ä–∏–≤–ª–µ—á–µ—Ç —É—Å–ø–µ—Ö",
    "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–µ–ª –æ—Å–≤–æ–±–æ–¥–∏—Ç –º–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ",
    "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è –ø–æ–¥—Å–∫–∞–∂–µ—Ç –≤–µ—Ä–Ω—ã–π –ø—É—Ç—å",
    "–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å–µ–≥–æ–¥–Ω—è –≤–∞–∂–Ω–µ–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏",
    "–í—Ä–µ–º—è –ø—Ä–æ—è–≤–∏—Ç—å –ª–∏–¥–µ—Ä—Å–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞",
    "–£—Å–ø–µ—Ö –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ —Ç–µ–º, –∫—Ç–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –ª—é–±–æ–≤—å—é –∫ –¥–µ–ª—É"
]

HEALTH_TEXTS = [
    "–ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–∏–ª—ã",
    "–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∂–∏–º —Å–Ω–∞",
    "–ô–æ–≥–∞ –∏–ª–∏ –º–µ–¥–∏—Ç–∞—Ü–∏—è –ø—Ä–∏–Ω–µ—Å—É—Ç –≥–∞—Ä–º–æ–Ω–∏—é",
    "–£–¥–µ–ª–∏—Ç–µ –≤—Ä–µ–º—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º",
    "–ü–µ–π—Ç–µ –±–æ–ª—å—à–µ –≤–æ–¥—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è",
    "–ò–∑–±–µ–≥–∞–π—Ç–µ –ø–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏—è",
    "–ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏—Ç —ç–Ω–µ—Ä–≥–∏—é",
    "–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–Ω–∏–º—É—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",
    "–ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –±–∞–ª–∞–Ω—Å",
    "–¢–µ–ø–ª—ã–π —á–∞–π –∏ —Ç–∏—à–∏–Ω–∞ ‚Äî –ª—É—á—à–µ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ —Å–µ–≥–æ–¥–Ω—è",
    "–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞ –∑–∞—Ä—è–¥–∏—Ç –±–æ–¥—Ä–æ—Å—Ç—å—é –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å",
    "–ú–∞—Å—Å–∞–∂ –∏–ª–∏ —Å–∞–º–æ–º–∞—Å—Å–∞–∂ —Å–Ω–∏–º–µ—Ç –º—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",
    "–ü—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è —É–ª—É—á—à–∏—Ç —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ",
    "–û—Ç–∫–∞–∑ –æ—Ç –∫–æ—Ñ–µ–∏–Ω–∞ –ø–æ—Å–ª–µ 16:00 —É–ª—É—á—à–∏—Ç —Å–æ–Ω",
    "–ü—Ä–æ–≥—É–ª–∫–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º –ø–æ–º–æ–∂–µ—Ç —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è",
    "–¢–µ–ø–ª–∞—è –≤–∞–Ω–Ω–∞ —Å —Å–æ–ª—å—é —Å–Ω–∏–º–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å",
    "–ü—Ä–æ–≥—É–ª–∫–∞ –±–æ—Å–∏–∫–æ–º –ø–æ —Ç—Ä–∞–≤–µ –∑–∞–∑–µ–º–ª–∏—Ç —ç–Ω–µ—Ä–≥–∏—é",
    "–ú–∏–Ω—É—Ç–∞ —Ç–∏—à–∏–Ω—ã –≤ –¥–µ–Ω—å ‚Äî –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ –∑–¥–æ—Ä–æ–≤—å–µ",
    "–°–º–µ—Ö –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —ç–º–æ—Ü–∏–∏ —É–∫—Ä–µ–ø–ª—è—é—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ —Ç–µ–ª–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –µ–≥–æ —Ä–µ—Å—É—Ä—Å—ã",
    "–û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏—Ç —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å",
    "–í—Ä–µ–º—è –¥–ª—è –¥–µ—Ç–æ–∫—Å–∞ –∏ –æ—á–∏—â–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞",
    "–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç –±–∞–ª–∞–Ω—Å",
    "–ó–∞–±–æ—Ç–∞ –æ —Ç–µ–ª–µ ‚Äî –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –ª—é–±–≤–∏ –∫ —Å–µ–±–µ"
]

ADVICE_TEXTS = [
    "–ë—É–¥—å—Ç–µ –≥–∏–±–∫–∏–º–∏ –≤ —Ä–µ—à–µ–Ω–∏—è—Ö",
    "–û—Ç–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Ç—É–∞—Ü–∏–µ–π",
    "–ü—Ä–æ—è–≤–∏—Ç–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ ‚Äî –≤—Å—ë –ø—Ä–∏–¥–µ—Ç –≤–æ–≤—Ä–µ–º—è",
    "–î–æ–≤–µ—Ä—å—Ç–µ—Å—å —Ç–µ—á–µ–Ω–∏—é –∂–∏–∑–Ω–∏",
    "–°–ª—É—à–∞–π—Ç–µ —Å–≤–æ–µ —Å–µ—Ä–¥—Ü–µ",
    "–ù–µ –±–æ–π—Ç–µ—Å—å –ø–µ—Ä–µ–º–µ–Ω",
    "–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ –≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–∏–º —Ü–µ–ª—è–º",
    "–§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Ç–æ–º, —á—Ç–æ –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –∏–∑–æ–±–∏–ª–∏–µ",
    "–í–∞—à–∞ –∏–Ω—Ç—É–∏—Ü–∏—è –∑–Ω–∞–µ—Ç –æ—Ç–≤–µ—Ç ‚Äî –¥–æ–≤–µ—Ä—å—Ç–µ—Å—å –µ–π",
    "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –≤—ã–±–æ—Ä –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å",
    "–ë—É–¥—å—Ç–µ –¥–æ–±—Ä—ã –∫ —Å–µ–±–µ –∏ –¥—Ä—É–≥–∏–º",
    "–ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –≤—ã–±–∏—Ä–∞–π—Ç–µ –º—É–¥—Ä–æ",
    "–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –Ω–æ–≤–æ–º—É –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –¥–∞—Ä—ã",
    "–¢–∏—à–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏ ‚Äî –∫–ª—é—á –∫ —è—Å–Ω–æ—Å—Ç–∏ —Å–Ω–∞—Ä—É–∂–∏",
    "–î–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—É, –¥–∞–∂–µ –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –≤–∏–¥–µ–Ω",
    "–í–∞—à–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –≤–∞—à–∞ —Å–∏–ª–∞",
    "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å ‚Äî –ø–æ–¥–∞—Ä–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —Å –ª—é–±–æ–≤—å—é",
    "–ú–∏—Ä –æ—Ç—Ä–∞–∂–∞–µ—Ç –≤–∞—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",
    "–í—ã —Å–æ–∑–¥–∞–µ—Ç–µ —Å–≤–æ—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∫–∞–∂–¥—ã–º –≤—ã–±–æ—Ä–æ–º",
    "–ü—Ä–∏–Ω—è—Ç–∏–µ ‚Äî –ø—É—Ç—å –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–≤–æ–±–æ–¥–µ",
    "–õ—é–±–æ–≤—å –∫ —Å–µ–±–µ ‚Äî –æ—Å–Ω–æ–≤–∞ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π",
    "–î–æ–≤–µ—Ä–∏–µ –≤—Å–µ–ª–µ–Ω–Ω–æ–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
    "–ö–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —Ä–æ—Å—Ç–∞"
]

# ====== –ó–ù–ê–ö-–°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –§–†–ê–ó–´ ======
ZODIAC_UNIQUE = {
    "‚ôàÔ∏è –û–≤–µ–Ω": [
        "–í–∞—à–∞ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É",
        "–ú–∞—Ä—Å —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É –ø—Ä–∏—Ä–æ–¥–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é",
        "–°–º–µ–ª–æ—Å—Ç—å –û–≤–Ω–∞ –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã",
        "–í–∞—à–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ—Ç —É–¥–∞—á—É"
    ],
    "‚ôâÔ∏è –¢–µ–ª–µ—Ü": [
        "–í–∞—à–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø–æ–º–æ–∂–µ—Ç –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å –ª—é–±—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
        "–í–µ–Ω–µ—Ä–∞ –¥–∞—Ä–∏—Ç –≤–∞–º –æ—Å–æ–±–æ–µ –æ–±–∞—è–Ω–∏–µ",
        "–¢–µ—Ä–ø–µ–Ω–∏–µ –¢–µ–ª—å—Ü–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –¥–æ—Å—Ç–æ–π–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º",
        "–í–∞—à–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å ‚Äî –æ–ø–æ—Ä–∞ –¥–ª—è –æ–∫—Ä—É–∂–∞—é—â–∏—Ö"
    ],
    "‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã": [
        "–í–∞—à–∞ –∫–æ–º–º—É–Ω–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
        "–ú–µ—Ä–∫—É—Ä–∏–π —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
        "–ì–∏–±–∫–æ—Å—Ç—å —É–º–∞ –ë–ª–∏–∑–Ω–µ—Ü–æ–≤ —Ä–µ—à–∏—Ç –ª—é–±—É—é –∑–∞–¥–∞—á—É",
        "–í–∞—à–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É —Å–µ–≥–æ–¥–Ω—è"
    ],
    "‚ôãÔ∏è –†–∞–∫": [
        "–í–∞—à–∞ –∏–Ω—Ç—É–∏—Ü–∏—è —Å–µ–≥–æ–¥–Ω—è –æ—Å–æ–±–µ–Ω–Ω–æ —Å–∏–ª—å–Ω–∞",
        "–õ—É–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∞—à–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏",
        "–ó–∞–±–æ—Ç–∞ –†–∞–∫–∞ —Å–æ–∑–¥–∞—Å—Ç –≥–∞—Ä–º–æ–Ω–∏—é –≤–æ–∫—Ä—É–≥",
        "–í–∞—à–∞ —ç–º–ø–∞—Ç–∏—è –∏—Å—Ü–µ–ª—è–µ—Ç –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç"
    ],
    "‚ôåÔ∏è –õ–µ–≤": [
        "–í–∞—à–∞ —Ö–∞—Ä–∏–∑–º–∞ –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—á—É —Å–µ–≥–æ–¥–Ω—è",
        "–°–æ–ª–Ω—Ü–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É –ø—Ä–∏—Ä–æ–¥–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
        "–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –õ—å–≤–∞ —Ä–∞—Å–∫—Ä–æ–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
        "–í–∞—à–µ –≤–µ–ª–∏–∫–æ–¥—É—à–∏–µ –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö"
    ],
    "‚ôçÔ∏è –î–µ–≤–∞": [
        "–í–∞—à–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –¥–µ—Ç–∞–ª—è–º –ø—Ä–∏–Ω–µ—Å–µ—Ç –ø–ª–æ–¥—ã",
        "–ú–µ—Ä–∫—É—Ä–∏–π –ø–æ–º–æ–≥–∞–µ—Ç –≤ –∞–Ω–∞–ª–∏–∑–µ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏",
        "–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å –î–µ–≤—ã –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º",
        "–í–∞—à–∞ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –∑–∞–ª–æ–≥ —É—Å–ø–µ—Ö–∞"
    ],
    "‚ôéÔ∏è –í–µ—Å—ã": [
        "–í–∞—à –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Ä–µ—à–∏—Ç –ª—é–±—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã",
        "–í–µ–Ω–µ—Ä–∞ –≥–∞—Ä–º–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
        "–ß—É–≤—Å—Ç–≤–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ –í–µ—Å–æ–≤ –Ω–∞–ø—Ä–∞–≤–∏—Ç –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –≤—ã–±–æ—Ä—É",
        "–í–∞—à –±–∞–ª–∞–Ω—Å –ø—Ä–∏–Ω–µ—Å–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—é –≤–æ –≤—Å–µ —Å—Ñ–µ—Ä—ã"
    ],
    "‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω": [
        "–í–∞—à–∞ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–∫—Ä–æ–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
        "–ü–ª—É—Ç–æ–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏–ª—É",
        "–ì–ª—É–±–∏–Ω–∞ –°–∫–æ—Ä–ø–∏–æ–Ω–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –≤–∞–∂–Ω—ã–º –æ–∑–∞—Ä–µ–Ω–∏—è–º",
        "–í–∞—à–∞ —Ä–µ—à–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç —Å–∏—Ç—É–∞—Ü–∏—é –∫ –ª—É—á—à–µ–º—É"
    ],
    "‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü": [
        "–í–∞—à –æ–ø—Ç–∏–º–∏–∑–º –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö",
        "–Æ–ø–∏—Ç–µ—Ä —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–∞—à–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã",
        "–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∏—Å—Ç–∏–Ω–µ –°—Ç—Ä–µ–ª—å—Ü–∞ –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ –ø—É—Ç–∏",
        "–í–∞—à–∞ —Å–≤–æ–±–æ–¥–æ–ª—é–±–∏–≤–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ—Ç —É–¥–∞—á—É"
    ],
    "‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥": [
        "–í–∞—à–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –≤–µ–¥–µ—Ç –∫ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–º—É —É—Å–ø–µ—Ö—É",
        "–°–∞—Ç—É—Ä–Ω —É–∫—Ä–µ–ø–ª—è–µ—Ç –≤–∞—à—É —Ä–µ—à–∏–º–æ—Å—Ç—å",
        "–£–ø–æ—Ä—Å—Ç–≤–æ –ö–æ–∑–µ—Ä–æ–≥–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –∑–Ω–∞—á–∏–º—ã–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º",
        "–í–∞—à–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –æ—Å–Ω–æ–≤–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏"
    ],
    "‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π": [
        "–í–∞—à–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–¥–µ–∏ –Ω–∞–π–¥—É—Ç –æ—Ç–∫–ª–∏–∫",
        "–£—Ä–∞–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ–∑–∞—Ä–µ–Ω–∏—è",
        "–ì—É–º–∞–Ω–∏–∑–º –í–æ–¥–æ–ª–µ—è –∏–∑–º–µ–Ω–∏—Ç –º–∏—Ä –∫ –ª—É—á—à–µ–º—É",
        "–í–∞—à–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è"
    ],
    "‚ôìÔ∏è –†—ã–±—ã": [
        "–í–∞—à–∞ —ç–º–ø–∞—Ç–∏—è –∏—Å—Ü–µ–ª—è–µ—Ç –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç",
        "–ù–µ–ø—Ç—É–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É –¥—É—Ö–æ–≤–Ω—É—é —Å–≤—è–∑—å",
        "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è –†—ã–± –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–µ —Ç–∞–ª–∞–Ω—Ç—ã",
        "–í–∞—à–∞ –º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —á—É–¥–µ—Å–∞–º"
    ]
}

# ====== –ë–ê–ó–ê –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ======
class UserDatabase:
    def __init__(self, filename='data/users.json'):
        self.filename = filename
        self.lock = Lock()
        self.data = self.load_data()
    
    def load_data(self):
        if os.path.exists(self.filename):
            try:
                with open(self.filename, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    for key in ['users', 'premium', 'payments', 'stats']:
                        if key not in data:
                            data[key] = {}
                    return data
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ë–î: {e}")
        return {k: {} for k in ['users', 'premium', 'payments', 'stats']}
    
    def save_data(self):
        try:
            with self.lock:
                with open(self.filename, 'w', encoding='utf-8') as f:
                    json.dump(self.data, f, ensure_ascii=False, indent=2)
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ë–î: {e}")
    
    def add_user(self, user_id, username, first_name):
        user_id_str = str(user_id)
        if user_id_str not in self.data['users']:
            self.data['users'][user_id_str] = {
                'username': username or 'unknown',
                'first_name': first_name or '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                'joined': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
                'horoscope_count': 0,
                'num_count': 0,
                'tarot_count': 0,
                'compatibility_count': 0,
                'last_zodiac': None,
                'last_horoscope_date': None,
                'chat_id': user_id,
                'birth_date': None,
                'life_path_number': None,
                'total_requests': 0
            }
            self.save_data()
            logger.info(f"üë§ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_id} ({first_name})")
    
    def get_user(self, user_id):
        return self.data['users'].get(str(user_id))
    
    def update_counter(self, user_id, counter_name):
        user_id_str = str(user_id)
        if user_id_str not in self.data['users']:
            self.add_user(user_id, None, None)
        if counter_name not in self.data['users'][user_id_str]:
            self.data['users'][user_id_str][counter_name] = 0
        self.data['users'][user_id_str][counter_name] += 1
        self.data['users'][user_id_str]['total_requests'] = self.data['users'][user_id_str].get('total_requests', 0) + 1
        self.save_data()
    
    def add_premium(self, user_id, days):
        user_id_str = str(user_id)
        end_date = (datetime.now() + timedelta(days=days)).strftime('%Y-%m-%d %H:%M:%S')
        self.data['premium'][user_id_str] = end_date
        self.save_data()
        logger.info(f"üíé –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è {user_id} –Ω–∞ {days} –¥–Ω–µ–π (–¥–æ {end_date})")
        return end_date
    
    def is_premium(self, user_id):
        user_id_str = str(user_id)
        if user_id_str in self.data['premium']:
            date_str = self.data['premium'][user_id_str]
            try:
                try:
                    end_date = datetime.strptime(date_str, '%Y-%m-%d %H:%M:%S')
                except ValueError:
                    try:
                        end_date = datetime.strptime(date_str, '%Y-%m-%d')
                    except ValueError:
                        del self.data['premium'][user_id_str]
                        self.save_data()
                        return False
                if end_date > datetime.now():
                    return True
                else:
                    del self.data['premium'][user_id_str]
                    self.save_data()
                    return False
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–º–∏—É–º–∞ {user_id}: {e}")
                return False
        return False
    
    def remove_premium(self, user_id):
        user_id_str = str(user_id)
        if user_id_str in self.data['premium']:
            del self.data['premium'][user_id_str]
            self.save_data()
            logger.info(f"‚ùå –ü—Ä–µ–º–∏—É–º —É–¥–∞–ª—ë–Ω –¥–ª—è {user_id}")
            return True
        return False
    
    def save_payment(self, payment_id, user_id, tariff_days, amount, status='pending'):
        try:
            if 'payments' not in self.data:
                self.data['payments'] = {}
            payment_record = {
                'user_id': str(user_id),
                'tariff_days': tariff_days,
                'amount': amount,
                'status': status,
                'created_at': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
            self.data['payments'][payment_id] = payment_record
            self.save_data()
            logger.info(f"üí∞ –ü–ª–∞—Ç–µ–∂ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {payment_id} | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_id} | –°—É–º–º–∞: {amount}‚ÇΩ | –°—Ç–∞—Ç—É—Å: {status}")
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞: {e}")
    
    def update_payment_status(self, payment_id, status):
        try:
            if 'payments' in self.data and payment_id in self.data['payments']:
                self.data['payments'][payment_id]['status'] = status
                self.data['payments'][payment_id]['updated_at'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                self.save_data()
                logger.info(f"üîÑ –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ {payment_id} –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞: {status}")
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞: {e}")
    
    def update_user_birth_date(self, user_id, birth_date, life_path):
        user_id_str = str(user_id)
        if user_id_str in self.data['users']:
            self.data['users'][user_id_str]['birth_date'] = birth_date
            self.data['users'][user_id_str]['life_path_number'] = life_path
            self.save_data()
    
    def get_all_users_stats(self):
        try:
            total_users = len(self.data.get('users', {}))
            premium_users = len(self.data.get('premium', {}))
            total_payments = len(self.data.get('payments', {}))
            
            successful_payments = 0
            total_revenue = 0
            for payment in self.data.get('payments', {}).values():
                if payment.get('status') == 'succeeded':
                    successful_payments += 1
                    total_revenue += float(payment.get('amount', 0))
            
            total_horoscopes = sum(u.get('horoscope_count', 0) for u in self.data.get('users', {}).values())
            total_numerology = sum(u.get('num_count', 0) for u in self.data.get('users', {}).values())
            total_tarot = sum(u.get('tarot_count', 0) for u in self.data.get('users', {}).values())
            total_compatibility = sum(u.get('compatibility_count', 0) for u in self.data.get('users', {}).values())
            
            return {
                'total_users': total_users,
                'premium_users': premium_users,
                'total_payments': total_payments,
                'successful_payments': successful_payments,
                'total_horoscopes': total_horoscopes,
                'total_numerology': total_numerology,
                'total_tarot': total_tarot,
                'total_compatibility': total_compatibility,
                'total_revenue': total_revenue
            }
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {e}")
            return {
                'total_users': 0,
                'premium_users': 0,
                'total_payments': 0,
                'successful_payments': 0,
                'total_horoscopes': 0,
                'total_numerology': 0,
                'total_tarot': 0,
                'total_compatibility': 0,
                'total_revenue': 0
            }

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
db = UserDatabase()

# ====== –ë–ò–ë–õ–ò–û–¢–ï–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ======
ZODIAC_IMAGES = {
    "‚ôàÔ∏è –û–≤–µ–Ω": "https://img.icons8.com/color/512/aries.png",
    "‚ôâÔ∏è –¢–µ–ª–µ—Ü": "https://img.icons8.com/color/512/taurus.png",
    "‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã": "https://img.icons8.com/color/512/gemini.png",
    "‚ôãÔ∏è –†–∞–∫": "https://img.icons8.com/color/512/cancer.png",
    "‚ôåÔ∏è –õ–µ–≤": "https://img.icons8.com/color/512/leo.png",
    "‚ôçÔ∏è –î–µ–≤–∞": "https://img.icons8.com/color/512/virgo.png",
    "‚ôéÔ∏è –í–µ—Å—ã": "https://img.icons8.com/color/512/libra.png",
    "‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω": "https://img.icons8.com/color/512/scorpio.png",
    "‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü": "https://img.icons8.com/color/512/sagittarius.png",
    "‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥": "https://img.icons8.com/color/512/capricorn.png",
    "‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π": "https://img.icons8.com/color/512/aquarius.png",
    "‚ôìÔ∏è –†—ã–±—ã": "https://img.icons8.com/color/512/pisces.png"
}

TAROT_IMAGES = {
    "–®—É—Ç": "https://img.icons8.com/color/512/jester.png",
    "–ú–∞–≥": "https://img.icons8.com/color/512/wizard.png",
    "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞": "https://img.icons8.com/color/512/queen.png",
    "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞": "https://img.icons8.com/color/512/empress.png",
    "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä": "https://img.icons8.com/color/512/king.png",
    "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç": "https://img.icons8.com/color/512/priest.png",
    "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ": "https://img.icons8.com/color/512/couple.png",
    "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞": "https://img.icons8.com/color/512/chariot.png",
    "–°–∏–ª–∞": "https://img.icons8.com/color/512/strength.png",
    "–û—Ç—à–µ–ª—å–Ω–∏–∫": "https://img.icons8.com/color/512/hermit.png"
}

# ====== –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø –ì–û–†–û–°–ö–û–ü–û–í ======
def get_current_date_string():
    months = {1: "—è–Ω–≤–∞—Ä—è", 2: "—Ñ–µ–≤—Ä–∞–ª—è", 3: "–º–∞—Ä—Ç–∞", 4: "–∞–ø—Ä–µ–ª—è", 5: "–º–∞—è", 6: "–∏—é–Ω—è",
              7: "–∏—é–ª—è", 8: "–∞–≤–≥—É—Å—Ç–∞", 9: "—Å–µ–Ω—Ç—è–±—Ä—è", 10: "–æ–∫—Ç—è–±—Ä—è", 11: "–Ω–æ—è–±—Ä—è", 12: "–¥–µ–∫–∞–±—Ä—è"}
    now = datetime.now()
    weekday = ["–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–≤—Ç–æ—Ä–Ω–∏–∫", "—Å—Ä–µ–¥–∞", "—á–µ—Ç–≤–µ—Ä–≥", "–ø—è—Ç–Ω–∏—Ü–∞", "—Å—É–±–±–æ—Ç–∞", "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"][now.weekday()]
    return f"{now.day} {months[now.month]} {now.year} –≥–æ–¥–∞ ({weekday})"

def generate_basic_horoscope(zodiac_sign, user_id=None, personalize=False):
    """
    –ë–∞–∑–æ–≤—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø ‚Äî –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø
    ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å + –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ + –ª—É–Ω–Ω–∞—è —Ñ–∞–∑–∞ + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
    """
    today = datetime.now().strftime("%Y-%m-%d")
    
    # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π seed –Ω–∞ –¥–µ–Ω—å + –∑–Ω–∞–∫ + (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) user_id
    if personalize and user_id:
        seed_input = f"{today}_{zodiac_sign}_{user_id}"
    else:
        seed_input = f"{today}_{zodiac_sign}"
    
    seed_hash = hashlib.md5(seed_input.encode()).hexdigest()
    seed_number = int(seed_hash[:8], 16)
    random.seed(seed_number)
    
    date_str = get_current_date_string()
    time_period, time_texts = get_time_period()
    moon_name, moon_desc = get_moon_phase()
    
    # –í—ã–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã
    energy = random.choice(ENERGY_TEXTS)
    love = random.choice(LOVE_TEXTS)
    career = random.choice(CAREER_TEXTS)
    health = random.choice(HEALTH_TEXTS)
    advice = random.choice(ADVICE_TEXTS)
    time_text = random.choice(time_texts)
    unique_phrase = random.choice(ZODIAC_UNIQUE.get(zodiac_sign, [""]))
    
    # –°–æ–±–∏—Ä–∞–µ–º –≥–æ—Ä–æ—Å–∫–æ–ø –ë–ï–ó f-—Å—Ç—Ä–æ–∫ —Å —ç–º–æ–¥–∑–∏ –≤–Ω—É—Ç—Ä–∏
    intro = "‚ú® *–ì–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è " + zodiac_sign + "* ‚ú®\n*–ù–∞ " + date_str + "*\n\n"
    time_section = "üåÖ *" + time_period.title() + ":* " + time_text + "\n\n"
    moon_section = moon_name + " ‚Äî " + moon_desc + "\n\n"
    main_text = energy + "\n\n"
    love_line = "üíñ *–õ—é–±–æ–≤—å:* " + love + "\n\n"
    career_line = "üíº *–ö–∞—Ä—å–µ—Ä–∞:* " + career + "\n\n"
    health_line = "üåø *–ó–¥–æ—Ä–æ–≤—å–µ:* " + health + "\n\n"
    advice_line = "üí´ *–°–æ–≤–µ—Ç:* " + advice + "\n\n"
    
    horoscope = intro + time_section + moon_section + main_text + love_line + career_line + health_line + advice_line
    
    if unique_phrase:
        horoscope += "*–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –≤–∞—à–µ–≥–æ –∑–Ω–∞–∫–∞:* " + unique_phrase + "\n\n"
    
    horoscope += "#" + zodiac_sign.split()[-1] + " #–ê—Å—Ç—Ä–æ–ª–æ–≥–∏—è #–ì–æ—Ä–æ—Å–∫–æ–ø"
    
    return horoscope

def generate_premium_horoscope(zodiac_sign, user_id=None, personalize=False):
    """–ü—Ä–µ–º–∏—É–º –≥–æ—Ä–æ—Å–∫–æ–ø –∏–∑ –±–∞–∑—ã (–ø–æ–ª–Ω—ã–π, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π)"""
    today = datetime.now().strftime("%Y-%m-%d")
    
    if today in PREMIUM_HOROSCOPES and zodiac_sign in PREMIUM_HOROSCOPES[today]:
        return PREMIUM_HOROSCOPES[today][zodiac_sign]
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –≤ –±–∞–∑–µ ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π
    base = generate_basic_horoscope(zodiac_sign, user_id, personalize)
    
    moon_name, moon_desc = get_moon_phase()
    
    premium_addition = """

‚ú® *–ü–†–ï–ú–ò–£–ú –î–û–ü–û–õ–ù–ï–ù–ò–ï* ‚ú®

*–ê—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:*
‚Ä¢ –õ—É–Ω–∞ –≤ –∑–Ω–∞–∫–µ: {moon}
‚Ä¢ –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –≤—Ä–µ–º—è: {time}
‚Ä¢ –ö–∞–º–µ–Ω—å-—Ç–∞–ª–∏—Å–º–∞–Ω: {stone}
‚Ä¢ –¶–≤–µ—Ç —É–¥–∞—á–∏: {color}

*–ù–µ–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑:*
{weekly}

#–ü—Ä–µ–º–∏—É–º""".format(
        moon=random.choice(['–û–≤–Ω–∞', '–¢–µ–ª—å—Ü–∞', '–ë–ª–∏–∑–Ω–µ—Ü–æ–≤', '–†–∞–∫–∞', '–õ—å–≤–∞', '–î–µ–≤—ã', '–í–µ—Å–æ–≤', '–°–∫–æ—Ä–ø–∏–æ–Ω–∞', '–°—Ç—Ä–µ–ª—å—Ü–∞', '–ö–æ–∑–µ—Ä–æ–≥–∞', '–í–æ–¥–æ–ª–µ—è', '–†—ã–±']),
        time=random.choice(['—É—Ç—Ä–æ 9-11', '–¥–µ–Ω—å 14-16', '–≤–µ—á–µ—Ä 19-21']),
        stone=random.choice(['–∞–º–µ—Ç–∏—Å—Ç', '–≥–æ—Ä–Ω—ã–π —Ö—Ä—É—Å—Ç–∞–ª—å', '—Ä–æ–∑–æ–≤—ã–π –∫–≤–∞—Ä—Ü', '–ª–∞–∑—É—Ä–∏—Ç', '—Ç–∏–≥—Ä–æ–≤—ã–π –≥–ª–∞–∑', '—Ü–∏—Ç—Ä–∏–Ω']),
        color=random.choice(['–∑–æ–ª–æ—Ç–æ–π', '–∏–∑—É–º—Ä—É–¥–Ω—ã–π', '—Å–∞–ø—Ñ–∏—Ä–æ–≤—ã–π', '—Ä—É–±–∏–Ω–æ–≤—ã–π', '–ª–∞–≤–∞–Ω–¥–æ–≤—ã–π']),
        weekly=random.choice([
            '–ù–µ–¥–µ–ª—è –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –∏ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞.',
            '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ñ–µ—Ä–∞ –±—É–¥–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–π –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏.',
            '–û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è.'
        ])
    )
    
    return base + premium_addition

# ====== HTTP-–°–ï–†–í–ï–† –î–õ–Ø RENDER (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!) ======
class HealthCheckHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        if self.path == "/health":
            self.send_response(200)
            self.send_header("Content-type", "text/plain")
            self.end_headers()
            self.wfile.write(b"OK")
        else:
            self.send_response(404)
            self.end_headers()
    
    def log_message(self, format, *args):
        # –ü–æ–¥–∞–≤–ª—è–µ–º –ª–æ–≥–∏ HTTP-—Å–µ—Ä–≤–µ—Ä–∞
        pass

def start_health_server():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç HTTP-—Å–µ—Ä–≤–µ—Ä –Ω–∞ PORT=10000 –¥–ª—è Render"""
    port = int(os.environ.get("PORT", 10000))
    server = HTTPServer(("0.0.0.0", port), HealthCheckHandler)
    logger.info(f"üåê HTTP-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {port}")
    server.serve_forever()

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞)
health_thread = Thread(target=start_health_server, daemon=True)
health_thread.start()

# ====== –û–°–ù–û–í–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ======
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global TECHNICAL_WORKS
    
    if TECHNICAL_WORKS:
        await update.message.reply_text(
            "üîß *–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã*\n\n–ë–æ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode='Markdown'
        )
        return
    
    user = update.effective_user
    user_id = user.id
    try:
        db.add_user(user_id, user.username, user.first_name)
        is_premium = db.is_premium(user_id)
        
        if is_premium:
            premium_status = "‚úÖ **–í–ê–® –ü–†–ï–ú–ò–£–ú –ê–ö–¢–ò–í–ï–ù!**"
        else:
            premium_status = "‚ú® *–ü–æ–ø—Ä–æ–±—É–π –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞!*"
        
        welcome_text = (
            "‚ú® *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, " + user.first_name + "!* üîÆ\n\n"
            "–Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫!\n\n"
            + premium_status + "\n\n"
            "*–î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å–ª—É–≥–∏:*\n"
            "‚Ä¢ üîÆ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ—Å–∫–æ–ø—ã (—Ä–∞–∑–Ω—ã–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!)\n"
            "‚Ä¢ üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è\n"
            "‚Ä¢ üÉè –ì–∞–¥–∞–Ω–∏–µ –Ω–∞ –¢–∞—Ä–æ\n"
            "‚Ä¢ üíé –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞\n\n"
            "–í—ã–±–µ—Ä–∏ —É—Å–ª—É–≥—É –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ üëá"
        )
        await update.message.reply_text(welcome_text, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ /start: {e}")
        await update.message.reply_text("–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –±–æ—Ç! üîÆ", reply_markup=get_main_keyboard())

async def handle_main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global TECHNICAL_WORKS
    
    if TECHNICAL_WORKS:
        await update.message.reply_text(
            "üîß *–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã*\n\n–ë–æ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode='Markdown'
        )
        return
        
    user_id = update.effective_user.id
    text = update.message.text
    try:
        is_premium = db.is_premium(user_id)
        if text == "üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø":
            date_str = get_current_date_string()
            await update.message.reply_text("üîÆ *–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ " + date_str + "*\n\n–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞:", reply_markup=get_zodiac_keyboard(), parse_mode='Markdown')
        elif text == "üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è":
            await update.message.reply_text("üî¢ *–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑*\n\n–í–≤–µ–¥–∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n`–î–î.–ú–ú.–ì–ì–ì–ì`\n\n*–ù–∞–ø—Ä–∏–º–µ—Ä:* `23.09.1992`", parse_mode='Markdown')
        elif text == "üÉè –¢–∞—Ä–æ":
            if is_premium:
                await update.message.reply_text("üÉè *–ì–∞–¥–∞–Ω–∏–µ –Ω–∞ –¢–∞—Ä–æ*\n\n–í—ã–±–µ—Ä–∏ —Ç–∏–ø —Ä–∞—Å–∫–ª–∞–¥–∞:", reply_markup=get_tarot_keyboard(), parse_mode='Markdown')
            else:
                await update.message.reply_text("üÉè *–ì–∞–¥–∞–Ω–∏–µ –Ω–∞ –¢–∞—Ä–æ*\n\n‚ùå *–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞!*\n\n–û—Ñ–æ—Ä–º–∏ –ø—Ä–µ–º–∏—É–º –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¢–∞—Ä–æ! üíé", reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
        elif text == "üíé –ü—Ä–µ–º–∏—É–º" or text == "‚≠ê –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–µ–Ω":
            if is_premium:
                premium_status = "‚úÖ **–í–ê–® –ü–†–ï–ú–ò–£–ú –ê–ö–¢–ò–í–ï–ù!**"
            else:
                premium_status = "‚ùå **–ü–†–ï–ú–ò–£–ú –ù–ï –ê–ö–¢–ò–í–ï–ù**"
            
            premium_text = (
                "üíé *–ü–†–ï–ú–ò–£–ú –ü–û–î–ü–ò–°–ö–ê*\n\n"
                + premium_status + "\n\n"
                "*–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º:*\n\n"
                "‚ú® **–†–ê–°–®–ò–†–ï–ù–ù–´–ï –ì–û–†–û–°–ö–û–ü–´**\n"
                "‚Ä¢ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑\n"
                "‚Ä¢ –ù–µ–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã\n"
                "‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n"
                "üÉè **–ì–ê–î–ê–ù–ò–ï –ù–ê –¢–ê–†–û**\n"
                "‚Ä¢ –ö–∞—Ä—Ç–∞ –¥–Ω—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º\n"
                "‚Ä¢ –†–∞—Å–∫–ª–∞–¥ –Ω–∞ 3 –∫–∞—Ä—Ç—ã\n"
                "‚Ä¢ –í—Å–µ –∫–∞—Ä—Ç—ã —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏\n\n"
                "üî¢ **–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –ù–£–ú–ï–†–û–õ–û–ì–ò–Ø**\n"
                "‚Ä¢ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —á–∏—Å–µ–ª\n"
                "‚Ä¢ –ö–∞—Ä–º–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏\n"
                "‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é\n\n"
                "–í—ã–±–µ—Ä–∏ —Ç–∞—Ä–∏—Ñ:"
            )
            await update.message.reply_text(premium_text, reply_markup=get_premium_keyboard(), parse_mode='Markdown')
        elif text == "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":
            user_info = db.get_user(user_id)
            if user_info:
                if is_premium:
                    premium_badge = "‚úÖ –ê–∫—Ç–∏–≤–µ–Ω"
                else:
                    premium_badge = "‚ùå –ù–µ –∞–∫—Ç–∏–≤–µ–Ω"
                
                stats_text = (
                    "üìä *–õ–ò–ß–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê*\n\n"
                    "üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* " + user_info.get('first_name', '–ì–æ—Å—Ç—å') + "\n"
                    "üìÖ *–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:* " + user_info.get('joined', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') + "\n"
                    "üíé *–ü—Ä–µ–º–∏—É–º:* " + premium_badge + "\n\n"
                    "*üìà –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–û –£–°–õ–£–ì:*\n"
                    "üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø—ã: " + str(user_info.get('horoscope_count', 0)) + "\n"
                    "üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è: " + str(user_info.get('num_count', 0)) + "\n"
                    "üÉè –¢–∞—Ä–æ: " + str(user_info.get('tarot_count', 0))
                )
            else:
                stats_text = "üìä *–í—ã –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —É—Å–ª—É–≥–∏ –±–æ—Ç–∞.*"
            await update.message.reply_text(stats_text, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
        elif text == "‚ÑπÔ∏è –ü–æ–º–æ—â—å":
            help_text = (
                "‚ÑπÔ∏è *–ü–û–ú–û–©–¨ –ò –ò–ù–§–û–†–ú–ê–¶–ò–Ø*\n\n"
                "*–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:*\n"
                "/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
                "/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n"
                "*–î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å–ª—É–≥–∏:*\n"
                "‚Ä¢ üîÆ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –≥–æ—Ä–æ—Å–∫–æ–ø—ã\n"
                "‚Ä¢ üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è\n"
                "‚Ä¢ üÉè –ì–∞–¥–∞–Ω–∏–µ –Ω–∞ –¢–∞—Ä–æ (–ø—Ä–µ–º–∏—É–º)\n"
                "‚Ä¢ üíé –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞\n\n"
                "*üí´ –í—Å–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–æ—Å—è—Ç —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä*"
            )
            await update.message.reply_text(help_text, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
        elif text == "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é":
            await update.message.reply_text("üîô –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=get_main_keyboard(user_id))
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é: {e}")
        await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", reply_markup=get_main_keyboard(user_id))

async def handle_zodiac_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global TECHNICAL_WORKS
    
    if TECHNICAL_WORKS:
        await update.message.reply_text(
            "üîß *–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã*\n\n–ë–æ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode='Markdown'
        )
        return
        
    user_id = update.effective_user.id
    text = update.message.text
    if text == "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é":
        await update.message.reply_text("üîô –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=get_main_keyboard(user_id))
        return
    zodiac_sign = text
    if zodiac_sign in ZODIAC_IMAGES:
        try:
            is_premium = db.is_premium(user_id)
            db.update_counter(user_id, 'horoscope_count')
            await update.message.reply_text("üîÆ *–ì–µ–Ω–µ—Ä–∏—Ä—É—é –≥–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è " + zodiac_sign + "...* ‚ú®", parse_mode='Markdown')
            if is_premium:
                horoscope = generate_premium_horoscope(zodiac_sign, user_id, personalize=True)
            else:
                horoscope = generate_basic_horoscope(zodiac_sign, user_id, personalize=False)
            try:
                await update.message.reply_photo(photo=ZODIAC_IMAGES[zodiac_sign], caption="‚ú® " + zodiac_sign + " ‚ú®")
                await asyncio.sleep(1)
            except Exception as e:
                logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {e}")
            await update.message.reply_text(horoscope, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ—Å–∫–æ–ø–∞: {e}")
            await update.message.reply_text("‚ú® *–ì–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è " + zodiac_sign + "* ‚ú®\n\n–°–µ–≥–æ–¥–Ω—è –∑–≤–µ–∑–¥—ã –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É—é—Ç –≤–∞–º!", reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
    else:
        await update.message.reply_text("üîÆ –í—ã–±–µ—Ä–∏ –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ –∏–∑ –º–µ–Ω—é!", reply_markup=get_zodiac_keyboard())

async def handle_numerology_input(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global TECHNICAL_WORKS
    
    if TECHNICAL_WORKS:
        await update.message.reply_text(
            "üîß *–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã*\n\n–ë–æ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            parse_mode='Markdown'
        )
        return
        
    user_id = update.effective_user.id
    text = update.message.text
    try:
        date_obj = datetime.strptime(text, '%d.%m.%Y')
        day, month, year = date_obj.day, date_obj.month, date_obj.year
        db.update_counter(user_id, 'num_count')
        await update.message.reply_text("üî¢ *–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤–∞—à–∏ —á–∏—Å–ª–∞...* ‚ú®", parse_mode='Markdown')
        life_path = sum(int(d) for d in str(day + month + year))
        while life_path > 9:
            life_path = sum(int(d) for d in str(life_path))
        
        personalities = [
            "**–õ–ò–î–ï–† –ò –ù–û–í–ê–¢–û–†** üí™\n–í—ã —Ä–æ–∂–¥–µ–Ω—ã, —á—Ç–æ–±—ã –≤–µ—Å—Ç–∏ –∑–∞ —Å–æ–±–æ–π.",
            "**–î–ò–ü–õ–û–ú–ê–¢ –ò –ú–ò–†–û–¢–í–û–†–ï–¶** ü§ù\n–í–∞—à –¥–∞—Ä - –Ω–∞—Ö–æ–¥–∏—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é.",
            "**–¢–í–û–†–ï–¶ –ò –û–ü–¢–ò–ú–ò–°–¢** üé®\n–í—ã –ø—Ä–∏–Ω–æ—Å–∏—Ç–µ –≤ –º–∏—Ä –∫—Ä–∞—Å–æ—Ç—É –∏ —Ä–∞–¥–æ—Å—Ç—å.",
            "**–°–¢–†–û–ò–¢–ï–õ–¨ –ò –ü–†–ê–ö–¢–ò–ö** üèóÔ∏è\n–í—ã —Å–æ–∑–¥–∞—ë—Ç–µ –ø—Ä–æ—á–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç.",
            "**–ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨ –ò –ê–í–ê–ù–¢–Æ–†–ò–°–¢** üåç\n–í–∞—à–∞ —Å—Ç–∏—Ö–∏—è - —Å–≤–æ–±–æ–¥–∞ –∏ –¥–≤–∏–∂–µ–Ω–∏–µ."
        ]
        advice_options = [
            "–î–æ–≤–µ—Ä—è–π—Ç–µ —Å–≤–æ–µ–º—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–æ–ª–æ—Å—É.",
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π.",
            "–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ —Å–≤–æ–∏–º–∏ —Å–ª–∞–±–æ—Å—Ç—è–º–∏, –ø—Ä–µ–≤—Ä–∞—â–∞—è –∏—Ö –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏."
        ]
        
        numerology_result = (
            "üî¢ *–ù–£–ú–ï–†–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ü–û–†–¢–†–ï–¢*\n\n"
            "*–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:* " + text + "\n"
            "*–ß–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏:* " + str(life_path) + "\n\n"
            + random.choice(personalities) + "\n\n"
            "*üí´ –°–æ–≤–µ—Ç:*\n"
            + random.choice(advice_options)
        )
        await update.message.reply_text(numerology_result, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
    except ValueError:
        await update.message.reply_text("‚ùå *–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã!*\n\n–ò—Å–ø–æ–ª—å–∑—É–π: `–î–î.–ú–ú.–ì–ì–ì–ì`\n*–ü—Ä–∏–º–µ—Ä:* `23.09.1992`", parse_mode='Markdown')
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏–∏: {e}")
        await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", reply_markup=get_main_keyboard(user_id))

async def handle_tarot_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global TECHNICAL_WORKS
    
    if TECHNICAL_WORKS:
        await update.callback_query.answer("üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã", show_alert=True)
        return
        
    query = update.callback_query
    await query.answer()
    user_id = query.from_user.id
    try:
        if not db.is_premium(user_id):
            await query.message.reply_text("‚ùå *–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞!*", reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
            return
        spread_type = query.data
        db.update_counter(user_id, 'tarot_count')
        if spread_type == "tarot_daily":
            await handle_tarot_daily(update, context, user_id)
        elif spread_type == "tarot_three":
            await handle_tarot_three(update, context, user_id)
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –¢–∞—Ä–æ: {e}")
        await query.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", reply_markup=get_main_keyboard(user_id))

async def handle_tarot_daily(update: Update, context: ContextTypes.DEFAULT_TYPE, user_id: int):
    query = update.callback_query
    card_name = random.choice(list(TAROT_IMAGES.keys()))
    card_image = TAROT_IMAGES[card_name]
    is_reversed = random.choice([True, False])
    try:
        caption = "üÉè *" + card_name + "* (" + ("–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è" if is_reversed else "–ø—Ä—è–º–∞—è") + ")"
        await query.message.reply_photo(photo=card_image, caption=caption)
    except Exception as img_error:
        logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã: {img_error}")
    
    tarot_text = (
        "üÉè *–ö–ê–†–¢–ê –î–ù–Ø*\n\n"
        "*–í—ã–ø–∞–ª–∞ –∫–∞—Ä—Ç–∞:*\n"
        "**" + card_name + "** (" + ("–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è" if is_reversed else "–ø—Ä—è–º–∞—è") + ")\n\n"
        "*üìñ –ó–Ω–∞—á–µ–Ω–∏–µ:*\n"
        + random.choice([
            "–≠—Ç–∞ –∫–∞—Ä—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞–∂–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–æ–ª–æ—Å–∞.",
            "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –Ω–µ—Å–µ—Ç –∫–ª—é—á–µ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.",
            "–ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—Ñ–µ—Ä—É –∂–∏–∑–Ω–∏."
        ]) + "\n\n"
        "*üéØ –°–æ–≤–µ—Ç –∫–∞—Ä—Ç—ã:*\n"
        + random.choice([
            "–î–æ–≤–µ—Ä—å—Ç–µ—Å—å –≤—Å–µ–ª–µ–Ω–Ω–æ–π –∏ —Å–ª–µ–¥—É–π—Ç–µ –∑–∞ —Å–≤–æ–∏–º –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ–º.",
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–º —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π.",
            "–ü—Ä–∏—Å–ª—É—à–∏–≤–∞–π—Ç–µ—Å—å –∫ —Å–≤–æ–µ–º—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–æ–ª–æ—Å—É –∏ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—é."
        ])
    )
    await query.message.reply_text(tarot_text, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')

async def handle_tarot_three(update: Update, context: ContextTypes.DEFAULT_TYPE, user_id: int):
    query = update.callback_query
    cards = random.sample(list(TAROT_IMAGES.items()), 3)
    for card_name, card_image in cards:
        try:
            await query.message.reply_photo(photo=card_image, caption="üÉè *" + card_name + "*")
            await asyncio.sleep(0.5)
        except Exception as img_error:
            logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {img_error}")
    
    tarot_text = (
        "üÉè *–†–ê–°–ö–õ–ê–î –ù–ê 3 –ö–ê–†–¢–´*\n\n"
        "*–ü—Ä–æ—à–ª–æ–µ (–≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é):*\n"
        "**" + cards[0][0] + "**\n"
        + random.choice([
            "–í–∞—à –ø—Ä–æ—à–ª—ã–π –æ–ø—ã—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –≤–∞—Å –∫ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏.",
            "–ü—Ä–æ—à–ª—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –≤–∞—à—É –∂–∏–∑–Ω—å."
        ]) + "\n\n"
        "*–ù–∞—Å—Ç–æ—è—â–µ–µ (—Ç–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è):*\n"
        "**" + cards[1][0] + "**\n"
        + random.choice([
            "–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –≤–∞—à–µ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏.",
            "–ö–∞—Ä—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —ç–Ω–µ—Ä–≥–∏–∏, –¥–µ–π—Å—Ç–≤—É—é—â–∏–µ –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ —Å–µ–π—á–∞—Å."
        ]) + "\n\n"
        "*–ë—É–¥—É—â–µ–µ (–≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ):*\n"
        "**" + cards[2][0] + "**\n"
        + random.choice([
            "–ë—É–¥—É—â–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–∏—Ö —Ç–µ–∫—É—â–∏—Ö —Ä–µ—à–µ–Ω–∏–π.",
            "–ö–∞—Ä—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π."
        ])
    )
    await query.message.reply_text(tarot_text, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')

async def handle_premium_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global TECHNICAL_WORKS
    
    if TECHNICAL_WORKS:
        await update.callback_query.answer("üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã", show_alert=True)
        return
        
    query = update.callback_query
    await query.answer()
    user_id = query.from_user.id
    try:
        tariff_map = {
            "premium_1": {"days": 30, "price": 29900},
            "premium_3": {"days": 90, "price": 79900},
            "premium_12": {"days": 365, "price": 199900}
        }
        tariff = tariff_map.get(query.data)
        if not tariff:
            return
        payment_id = str(uuid.uuid4())
        db.save_payment(payment_id, user_id, tariff['days'], tariff['price']/100)
        payload = str(user_id) + "_" + str(tariff['days']) + "_" + payment_id
        prices = [LabeledPrice(label="–ü—Ä–µ–º–∏—É–º –Ω–∞ " + str(tariff['days']) + " –¥–Ω–µ–π", amount=tariff['price'])]
        await context.bot.send_invoice(
            chat_id=query.message.chat_id,
            title="üíé –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ " + str(tariff['days']) + " –¥–Ω–µ–π",
            description="–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –±–æ—Ç–∞ –Ω–∞ " + str(tariff['days']) + " –¥–Ω–µ–π",
            payload=payload,
            provider_token=PAYMENT_PROVIDER_TOKEN,
            currency="RUB",
            prices=prices,
            start_parameter="premium_subscription",
            need_name=False,
            need_phone_number=False,
            need_email=False,
            need_shipping_address=False,
            is_flexible=False,
            disable_notification=False,
            protect_content=False
        )
        logger.info(f"üí≥ –ò–Ω–≤–æ–π—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id}, —Ç–∞—Ä–∏—Ñ {tariff['days']} –¥–Ω–µ–π")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω–≤–æ–π—Å–∞: {e}")
        await query.message.reply_text("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.", reply_markup=get_main_keyboard(user_id))

async def pre_checkout_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.pre_checkout_query
    await query.answer(ok=True)
    logger.info(f"‚úÖ Pre-checkout –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω: {query.id}")

async def successful_payment_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    payment = update.message.successful_payment
    user_id = update.effective_user.id
    try:
        if payment.invoice_payload:
            payload_parts = payment.invoice_payload.split('_')
            if len(payload_parts) >= 3:
                payment_id = payload_parts[2]
                tariff_days = int(payload_parts[1])
                db.update_payment_status(payment_id, 'succeeded')
                premium_until = db.add_premium(user_id, tariff_days)
                success_text = (
                    "üíé *–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ü–†–ï–ú–ò–£–ú –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!* üéâ\n\n"
                    "‚úÖ *–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!*\n"
                    "üí∞ *–°—É–º–º–∞:* " + str(payment.total_amount / 100) + "‚ÇΩ\n"
                    "üìÖ *–¢–∞—Ä–∏—Ñ:* " + str(tariff_days) + " –¥–Ω–µ–π\n"
                    "üìÖ *–ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–µ–Ω –¥–æ:* " + premium_until.split()[0] + "\n\n"
                    "–¢–µ–ø–µ—Ä—å —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø–Ω—ã –í–°–ï —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞! ‚ú®"
                )
                await update.message.reply_text(success_text, reply_markup=get_main_keyboard(user_id), parse_mode='Markdown')
                logger.info(f"‚úÖ –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id}, {tariff_days} –¥–Ω–µ–π")
                return
        await update.message.reply_text("‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.", reply_markup=get_main_keyboard(user_id))
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞: {e}")
        await update.message.reply_text("‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –ï—Å–ª–∏ –ø—Ä–µ–º–∏—É–º –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.", reply_markup=get_main_keyboard(user_id))

async def handle_back_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    user_id = query.from_user.id
    try:
        await query.edit_message_text("üîô –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é...", reply_markup=get_main_keyboard(user_id))
    except Exception as e:
        logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}")
        try:
            await query.message.reply_text("üîô –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=get_main_keyboard(user_id))
        except Exception as e2:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞: {e2}")

# ====== –ê–î–ú–ò–ù–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò ======
async def admin_panel(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if user_id != ADMIN_USER_ID:
        await update.message.reply_text("‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
        return
    
    stats = db.get_all_users_stats()
    
    if TECHNICAL_WORKS:
        tech_status = "üî¥ –í–ö–õ–Æ–ß–ï–ù–´"
    else:
        tech_status = "üü¢ –í–´–ö–õ–Æ–ß–ï–ù–´"
    
    admin_text = (
        "üõ†Ô∏è *–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨*\n\n"
        "*–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*\n"
        "üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: " + str(stats['total_users']) + "\n"
        "üíé –ü—Ä–µ–º–∏—É–º: " + str(stats['premium_users']) + "\n"
        "üí∞ –ü–ª–∞—Ç–µ–∂–µ–π: " + str(stats['total_payments']) + "\n"
        "‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö: " + str(stats['successful_payments']) + "\n\n"
        "*–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã:*\n"
        + tech_status + "\n\n"
        "*–ö–æ–º–∞–Ω–¥—ã:*\n"
        "/send <—Ç–µ–∫—Å—Ç> - —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º\n"
        "/tech_on - –≤–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö. —Ä–∞–±–æ—Ç—ã\n"
        "/tech_off - –≤—ã–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö. —Ä–∞–±–æ—Ç—ã\n"
        "/stats - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
    )

    keyboard = [
        [InlineKeyboardButton("üì§ –†–∞—Å—Å—ã–ª–∫–∞", callback_data="admin_broadcast")],
        [InlineKeyboardButton("üîß –¢–µ—Ö. —Ä–∞–±–æ—Ç—ã: –í–ö–õ", callback_data="admin_tech_on")],
        [InlineKeyboardButton("‚úÖ –¢–µ—Ö. —Ä–∞–±–æ—Ç—ã: –í–´–ö–õ", callback_data="admin_tech_off")],
        [InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_stats")],
        [InlineKeyboardButton("üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º–æ–º", callback_data="admin_premium")]
    ]
    
    await update.message.reply_text(
        admin_text,
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode='Markdown'
    )

async def handle_admin_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    if query.from_user.id != ADMIN_USER_ID:
        await query.message.reply_text("‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
        return
    
    global TECHNICAL_WORKS
    
    if query.data == "admin_broadcast":
        context.user_data['awaiting_broadcast'] = True
        await query.message.reply_text("üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏:")
        
    elif query.data == "admin_tech_on":
        TECHNICAL_WORKS = True
        await query.message.edit_text("üî¥ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã –í–ö–õ–Æ–ß–ï–ù–´")
        
    elif query.data == "admin_tech_off":
        TECHNICAL_WORKS = False
        await query.message.edit_text("üü¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã –í–´–ö–õ–Æ–ß–ï–ù–´")
        
    elif query.data == "admin_stats":
        stats = db.get_all_users_stats()
        stats_text = (
            "üìä *–û–ë–ù–û–í–õ–Å–ù–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê*\n\n"
            "üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: " + str(stats['total_users']) + "\n"
            "üíé –ü—Ä–µ–º–∏—É–º: " + str(stats['premium_users']) + "\n"
            "üí∞ –ü–ª–∞—Ç–µ–∂–µ–π: " + str(stats['total_payments']) + "\n"
            "‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö: " + str(stats['successful_payments'])
        )
        await query.message.reply_text(stats_text, parse_mode='Markdown')
        
    elif query.data == "admin_premium":
        await query.message.reply_text(
            "üëë *–£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–ï–ú–ò–£–ú–û–ú*\n\n"
            "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
            "`/premium_add <user_id> <days>` - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–º–∏—É–º\n"
            "`/premium_remove <user_id>` - —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ–º–∏—É–º\n"
            "`/premium_list` - —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
            parse_mode='Markdown'
        )

async def handle_admin_commands(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if update.effective_user.id != ADMIN_USER_ID:
        return
        
    text = update.message.text.strip()
    
    if text.startswith('/premium_add'):
        parts = text.split()
        if len(parts) == 3:
            try:
                user_id = int(parts[1])
                days = int(parts[2])
                premium_until = db.add_premium(user_id, days)
                response = (
                    "‚úÖ –ü—Ä–µ–º–∏—É–º –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é " + str(user_id) + " –Ω–∞ " + str(days) + " –¥–Ω–µ–π\n"
                    "–î–æ: " + premium_until
                )
                await update.message.reply_text(response)
            except ValueError:
                await update.message.reply_text("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `/premium_add <user_id> <days>`")
        else:
            await update.message.reply_text("‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
            
    elif text.startswith('/premium_remove'):
        parts = text.split()
        if len(parts) == 2:
            try:
                user_id = int(parts[1])
                if db.remove_premium(user_id):
                    await update.message.reply_text("‚úÖ –ü—Ä–µ–º–∏—É–º —É–¥–∞–ª—ë–Ω —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è " + str(user_id))
                else:
                    await update.message.reply_text("‚ùå –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è " + str(user_id) + " –Ω–µ—Ç –ø—Ä–µ–º–∏—É–º–∞")
            except ValueError:
                await update.message.reply_text("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `/premium_remove <user_id>`")
        else:
            await update.message.reply_text("‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
            
    elif text == '/premium_list':
        premium_users = list(db.data.get('premium', {}).keys())
        if premium_users:
            users_list = "\n".join(["‚Ä¢ " + uid for uid in premium_users[:20]])
            response = "üëë *–ü–†–ï–ú–ò–£–ú –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò* (" + str(len(premium_users)) + "):\n\n" + users_list
            await update.message.reply_text(response, parse_mode='Markdown')
        else:
            await update.message.reply_text("üëë –ù–µ—Ç –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
            
    elif text.startswith('/send'):
        broadcast_text = text[5:].strip()
        if broadcast_text:
            users = list(db.data['users'].keys())
            success_count = 0
            for uid in users:
                try:
                    await context.bot.send_message(
                        chat_id=int(uid),
                        text="üì¢ *–†–ê–°–°–´–õ–ö–ê*\n\n" + broadcast_text,
                        parse_mode='Markdown'
                    )
                    success_count += 1
                except Exception as e:
                    logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É {uid}: {e}")
            await update.message.reply_text("‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ " + str(success_count) + " –∏–∑ " + str(len(users)) + " –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
        else:
            await update.message.reply_text("‚ùå –ü—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏")

async def handle_broadcast_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if update.effective_user.id != ADMIN_USER_ID:
        return
        
    if context.user_data.get('awaiting_broadcast'):
        broadcast_text = update.message.text
        context.user_data['awaiting_broadcast'] = False
        
        users = list(db.data['users'].keys())
        success_count = 0
        
        for uid in users:
            try:
                await context.bot.send_message(
                    chat_id=int(uid),
                    text="üì¢ *–†–ê–°–°–´–õ–ö–ê*\n\n" + broadcast_text,
                    parse_mode='Markdown'
                )
                success_count += 1
            except Exception as e:
                logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É {uid}: {e}")
        
        await update.message.reply_text(
            "‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ " + str(success_count) + " –∏–∑ " + str(len(users)) + " –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        )

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    error = context.error
    if error:
        logger.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {error}", exc_info=error)
        try:
            if update and update.effective_user:
                error_text = "üòî *–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞*\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é."
                await context.bot.send_message(chat_id=update.effective_user.id, text=error_text, parse_mode='Markdown', reply_markup=get_main_keyboard(update.effective_user.id))
        except Exception as send_error:
            logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: {send_error}")

# ====== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã) ======
def get_main_keyboard(user_id=None):
    is_premium = db.is_premium(user_id) if user_id else False
    if is_premium:
        premium_btn = "‚≠ê –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–µ–Ω"
    else:
        premium_btn = "üíé –ü—Ä–µ–º–∏—É–º"
    
    keyboard = [
        ["üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø", "üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è"],
        ["üÉè –¢–∞—Ä–æ", premium_btn],
        ["üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "‚ÑπÔ∏è –ü–æ–º–æ—â—å"]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

def get_zodiac_keyboard():
    keyboard = [
        ["‚ôàÔ∏è –û–≤–µ–Ω", "‚ôâÔ∏è –¢–µ–ª–µ—Ü", "‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã"],
        ["‚ôãÔ∏è –†–∞–∫", "‚ôåÔ∏è –õ–µ–≤", "‚ôçÔ∏è –î–µ–≤–∞"],
        ["‚ôéÔ∏è –í–µ—Å—ã", "‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω", "‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü"],
        ["‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥", "‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π", "‚ôìÔ∏è –†—ã–±—ã"],
        ["üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

def get_premium_keyboard():
    keyboard = [
        [InlineKeyboardButton("üíé 1 –º–µ—Å—è—Ü - 299‚ÇΩ", callback_data="premium_1")],
        [InlineKeyboardButton("üíé 3 –º–µ—Å—è—Ü–∞ - 799‚ÇΩ", callback_data="premium_3")],
        [InlineKeyboardButton("üíé 12 –º–µ—Å—è—Ü–µ–≤ - 1999‚ÇΩ", callback_data="premium_12")],
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="back_main")]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_tarot_keyboard():
    keyboard = [
        [InlineKeyboardButton("üÉè –ö–∞—Ä—Ç–∞ –¥–Ω—è", callback_data="tarot_daily")],
        [InlineKeyboardButton("üÉè 3 –∫–∞—Ä—Ç—ã", callback_data="tarot_three")],
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="back_main")]
    ]
    return InlineKeyboardMarkup(keyboard)

# ====== –ó–ê–ü–£–°–ö –ë–û–¢–ê ======
def main():
    print("=" * 70)
    print("üîÆ –ó–ê–ü–£–°–ö –ê–°–¢–†–û–õ–û–ì–ò–ß–ï–°–ö–û–ì–û –ë–û–¢–ê")
    print("=" * 70)
    
    stats = db.get_all_users_stats()
    print("üìä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: " + str(stats['total_users']))
    print("üíé –ü—Ä–µ–º–∏—É–º: " + str(stats['premium_users']))
    print("üí∞ –ü–ª–∞—Ç–µ–∂–µ–π: " + str(stats['total_payments']))
    print("=" * 70)
    
    try:
        app = Application.builder().token(BOT_TOKEN).build()
        
        # –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        app.add_handler(CommandHandler("start", start))
        app.add_handler(CommandHandler("help", start))
        app.add_handler(MessageHandler(filters.Regex(r'^(üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø|üî¢ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è|üÉè –¢–∞—Ä–æ|üíé –ü—Ä–µ–º–∏—É–º|‚≠ê –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–µ–Ω|üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞|‚ÑπÔ∏è –ü–æ–º–æ—â—å)$'), handle_main_menu))
        app.add_handler(MessageHandler(filters.Regex(r'^(‚ôàÔ∏è –û–≤–µ–Ω|‚ôâÔ∏è –¢–µ–ª–µ—Ü|‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã|‚ôãÔ∏è –†–∞–∫|‚ôåÔ∏è –õ–µ–≤|‚ôçÔ∏è –î–µ–≤–∞|‚ôéÔ∏è –í–µ—Å—ã|‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω|‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü|‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥|‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π|‚ôìÔ∏è –†—ã–±—ã|üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é)$'), handle_zodiac_selection))
        app.add_handler(MessageHandler(filters.Regex(r'^\d{2}\.\d{2}\.\d{4}$'), handle_numerology_input))
        app.add_handler(CallbackQueryHandler(handle_tarot_callback, pattern="^tarot_"))
        app.add_handler(CallbackQueryHandler(handle_premium_callback, pattern="^premium_"))
        app.add_handler(CallbackQueryHandler(handle_back_callback, pattern="^back_"))
        app.add_handler(PreCheckoutQueryHandler(pre_checkout_handler))
        app.add_handler(MessageHandler(filters.SUCCESSFUL_PAYMENT, successful_payment_handler))
        app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_main_menu))
        
        # –ê–¥–º–∏–Ω—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        app.add_handler(CommandHandler("admin", admin_panel))
        app.add_handler(MessageHandler(filters.TEXT & filters.User(ADMIN_USER_ID), handle_admin_commands))
        app.add_handler(MessageHandler(filters.TEXT & filters.User(ADMIN_USER_ID), handle_broadcast_text))
        app.add_handler(CallbackQueryHandler(handle_admin_callback, pattern="^admin_"))
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        app.add_error_handler(error_handler)
        
        print("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
        print("üì± –ù–∞–ø–∏—à–∏—Ç–µ /start –≤ Telegram")
        print("üëë –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥–∞: /admin")
        print("=" * 70)
        
        app.run_polling(drop_pending_updates=True)
        
    except KeyboardInterrupt:
        print("\nüëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        logger.critical(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ó–ê–ü–£–°–ö–ê: {e}")
        print(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")

if __name__ == "__main__":
    main()
